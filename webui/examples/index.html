<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html>
	<head>
		<title>Example</title>
		
		<style type="text/css" title="currentStyle">
			@import "media/css/demo_page.css";
			@import "media/css/demo_table.css";
		</style>
		
		<link rel="stylesheet" type="text/css" href="facebox/facebox.css" />
		
		<style type="text/css">
		</style>

		<script type="text/javascript" language="javascript" src="media/js/jquery.js"></script>

		<script type="text/javascript" language="javascript" src="media/js/jquery.dataTables.js"></script>
	
		<script type="text/javascript" language="javascript" src="media/js/date.js"></script>
		
		<script type="text/javascript" language="javascript" src="facebox/facebox.js"></script>
		
		<script type="text/javascript" language="javascript" src="media/js/jquery.labelify.js"></script>
		
		<script type="text/javascript" language="javascript" src="media/js/jquery.form.js"></script>
		
		<script type="text/javascript" language="javascript" src="media/js/jquery.populate.js"></script>

		<script type="text/javascript">
			var URL = 'http://localhost:4000/webui?callback=?';
			var DOWNLOAD_PREFIX = 'http://localhost:4000/download?id=';				

			var torrentData = [];

			var torrentHeadings = [
				{
					"sTitle": "Name",
					"fnRender": function (oObj) {
						return '<a href="' + DOWNLOAD_PREFIX + oObj.aData[5] + '">' + oObj.aData[0] + '</a>';
					},
					"bUseRendered": false
				 },
				{ "sTitle": "Seeds" },
				{ "sTitle": "Leechers" },
				{ "sTitle": "Completed" },
				{
					"sTitle": "Added",
					"fnRender": function (oObj) {
						return Date.parse(oObj.aData[4]).toString('MMMM d, yyyy');
					},
					"bUseRendered": false
				},
				{ "sTitle": "ID", "bVisible": false },
				{ "sTitle": "Category", "bVisible": false },
				{ "sTitle": "Uploaded By", "bVisible": false }
			];

			function populateTable() {
				$.getJSON(URL, {}, function (torrents) {
					$.each(torrents, function(i, torrent) {
						torrentData.push(
							[torrent.name, torrent.seeds, torrent.leechers, torrent.completed, torrent.pub_date, torrent.info_hash, torrent.category, torrent.uploaded_by]
							);
					});
			
					$('#demo').html('<table cellpadding="0" cellspacing="0" border="0" class="display" id="example"></table>');
		
					torrentTable = $('#example').dataTable({
						"aaData": torrentData,
						"aoColumns": torrentHeadings,
						"bPaginate": false,
						"aaSorting": [[4, 'desc']],
						"bSortClasses": false
					});
				
					torrentTable.fnFilter('#gamemp3s', 6);
				
				});					
			}
		</script>
			
		<script type="text/javascript">
			var username = '';
			var password = '';
			var categories = [];
		
			function saveLoginInformation(formData, jqForm, options) {
				var form = jqForm[0];
				username = form.username.value;
				password = form.password.value;
				return true;
			}
			
			function processLogin(data) {
				if (data.success) {
					$.facebox($('#upload'));
					
					$('#facebox #upload form').populate({
						'username': username,
						'password': password,
					})
					
					$.each(data.categories, function (category) {
						$('#facebox #upload form select').append(
							$('<option />').val(data.categories[category]).text(data.categories[category])
						);
					});
					
					$('#facebox #upload form').ajaxForm({
						dataType: 'json',
					});
					
					$("#facebox #upload").fadeIn();
				} else {
					$("#facebox .footer").text('Bad login').fadeIn();
					$('#facebox input[title]').labelify();
				}
			}
		</script>
				
		<script type="text/javascript">
			$(document).ready(function($) {
				$('a[rel*=facebox]').facebox();
				$(document).bind('reveal.facebox', function() {
					$('#facebox .footer').empty().hide();
					$('#facebox input[title]').labelify();
					$('#facebox #login form').ajaxForm({
						dataType: 'json',
						beforeSubmit: saveLoginInformation,
						success: processLogin
					});
				});
				populateTable();
			});
		</script>
		
		<style type="text/css">
			#demo { width: 75%; margin: auto; font-size: 85%; font-family: sans-serif;}
		</style>
	</head>
	
	<body>
		<h1>Torrents</h1>
		
		<p>
			<a href="#login" rel="facebox">Log in</a>
		</p>
		
		<div id="demo">
			Loading&hellip;
		</div>
		
		<div id="login" style="display: none;">
		    <form action="http://localhost:4000/login" method="post">
		      <p>
		        <input type="text" name="username" title="Username" />
		      </p>
		      <p>
		        <input type="password" name="password" title="Password" />
		      </p>
		      <p>
		        <button type="submit">Log in</button> 
		      </p>
			</form>
		</div>
		
		<div id="upload" style="display: none;">
		    <form action="http://localhost:4000/upload" method="post">
		    	<p>
			        <input type="hidden" name="username" />
			        <input type="hidden" name="password" />
					<label for="torrent">Torrent</label>
					<input type="file" name="torrent" />
				</p>
				<p>
					<label for="category">Category</label>
					<select name="category">
					</select>
				</p>
		      <p>
		        <button type="submit">Upload Torrent</button> 
		      </p>
			</form>
		</div>

	</body>
	
</html>